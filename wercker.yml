box: node:6

build:
    steps:
        - script:
            name: npm install
            code: env NODE_ENV=dev npm install --quiet && npm list --depth 0  --quiet

        - script:
            name: build
            code: npm run build

        - script:
            # need COVERALLS_REPO_TOKEN env var set
            name: test
            code: |
                npm run test:coverage
                npm run coverage:report



publish-npm:
    steps:

        - script:
            name: prepublish
            code: npm run prepublish

        - kwakayama/npm-publish:
            # need NPM_EMAIL, NPM_AUTH_TOKEN env var set
            name: publish to npm

deploy-doc:
    steps:

        - script:
            name: install gitbook
            code: sudo npm install -g gitbook

        - script:
            name: build docs
            code: gitbook install && gitbook build

        - takuma7/gh-pages:
            name: deploy doc to gh-pages
            token: $GH_TOKEN
            basedir: _book
